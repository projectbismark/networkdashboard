{% extends "base.html" %}
{% block content %}

<div class ="section" id="section_1">
    <div class ="banner" id ="banner_1"></div>
    <div id="section_text">
    <h1>BISMark Device           <a href ="/editDevicePage/{{detail.hashkey}}"> Edit </a></h1>
    <script src="/static/jquery-latest.js"></script>
    <script src="/static/highcharts.js"></script>
    <script src="/static/js/modules/exporting.js"></script>

    <table>
        <!--
        <tr><td>MAC Address</td><td>{{ detail.macid }}</td></tr>
        <tr><td>Type</td><td>{{ detail.type }}</td></tr>
        <tr><td>Operating System</td><td>{{ detail.os }}</td></tr> -->
        <tr><td><b>Name</b></td><td><b>{{ detail.name }}</b></td></tr>
        <tr><td>ISP</td><td>{{ detail.isp }}</td></tr>
        <tr><td>Location</td><td><div id="location{{ deviceid }}"></div><script type="text/javascript">

		$.ajax({
                type: "GET",
                url: escape("/getLocation/{{ deviceid }}/"),
                success: OnSuccess
            });
		
		function OnSuccess(data)
		{
		document.getElementById('location{{ deviceid }}').innerHTML = data;
		}

		</script></td>
        </tr>     
        <tr><td>Service Plan</td><td>{{ detail.serviceplan }}</td></tr>
        <tr><td>Download Rate</td><td>{{ detail.downloadrate}} kbps</td></tr>
        <tr><td>Upload Rate</td><td>{{ detail.uploadrate}} kbps</td></tr>
    
 
  
        
	

<tr><td>First Measurement</td><td>{{ firstUpdate }}</td></tr>
<tr><td>Last Measurement</td><td>{{ lastUpdate }}</td></tr>

 
<tr><td>Raw Data</td></td><td><a href="http://projectbismark.net/data/{{ deviceid }}">Download XML</a></td></tr>

<tr><td>URL for this device page</td><td><input id="url" type="text" style="width:320px;" value="http://networkdashboard.org/displayDevice/{{ detail.hashkey }}" ></td></tr>
<tr><td><a href ="/feedback.html/?hashkey={{detail.hashkey}}" onClick ="return feedback(this, 'feedback')"><b>Feedback</b></a></td></tr>
    
</table>
</div>
</div>
<div class="section" id="section_2">
    <div class ="banner" id ="banner_1"></div>
    <div id ="section_text">

<script type="text/javascript" src="/static/dygraph-combined.js"></script>


<body class=" claro " onload="CloseProgressBar()">


<table border="0"> 

<tr>
<td>
<input type="radio" name="g1" id="g1rb3" checked>
<label for="g1rb3">Upload and Download Throughput (kbps)</label><br/><br/>
<input type="radio" name="g1" id="g1rb2">
<label for="g1rb2">Last-Mile Latency (ms)</label><br/><br/>
<input type="radio" name="g1" id="g1rb1">
<label for="g1rb1">Round Trip Time (ms)</label><br/><br/>
<input type="radio" name="g1" id="g1rb4">
<label for="g1rb1">Passive Measurements</label><br/><br/>
<input type="radio" name="g1" id="g1rb5">
<label for="g1rb5">Passive Measurement By Port<p style="font-size: 12;">Note: Passive Data not collected without explicit permission by user</p></label>
<div class="menu" id="drop_menu_1">
    Compare to other devices based on:<br/>
    <select id="select_menu_1">
        <option value = "none" selected>Don't Compare</option>
        <option value ="location">Location({{num_location}})</option>
        <option value ="provider">Provider({{num_provider}})</option>
    </select>
</div>
<button type="submit" name="submit" onClick=" render()">Display</button>
</td>
</tr>
</table>

</div>
</div>


        

<br />
<div class="progresscontainer">
    <div class="progressbar" id="progress" indeterminate="true" title="loading" ></div>
</div>
<br /><br /><br />
<div class ="graphdisplay" id = "display_tag" >
    <div id="graph_place_holder" style="width:600px; height: 300px;"></div>
</div>
    
<!--    <div class ="radiodiv"
    <input type="radio" name = "mode" id="lin" onClick="setDisplayMode(false)" checked>
    <label for="lin">Linear</label>

    <input type="radio" name = "mode" id="log" onClick ="setDisplayMode(true)">
    <label for="log">Log</label><br /><br />
    </div>-->
<script type="text/javascript">

	var content="[not loaded]";
	var limit = 1000000;
	var units = "kbps";
	var paramselect = "AGGL3BITRATE";
        var logdisplay = false;
        var filter = "none";
        var divid = "graph_div_1";
        var titlename ="Download Throughput";
        var formatter = function(){
            return ''+ Highcharts.dateFormat('%e. %b %Y, %l %p', this.x) +': <br/> <br/><b>'+ this.points[0].y +'</b> m/s';
        };
        var legend = {
            enabled: true,
            align: 'right',
            backgroundColor: '#FCFFC5',
            borderColor: 'black',
            borderWidth: 2,
            layout: 'vertical',
            verticalAlign: 'top',
            y: 100,
            shadow: true
        };
        
        
        var rangeselector={
                buttons: [{
                        type: 'day',
                        count: 1,
                        text: '1d'
                }, {
                        type: 'week',
                        count: 1,
                        text: '1w'
                }, {
                        type: 'month',
                        count: 1,
                        text: '1m'
                }, {
                        type: 'month',
                        count: 3,
                        text: '3m'
                }, {
                        type: 'month',
                        count: 6,
                        text: '6m'
                }, {
                        type: 'ytd',
                        text: 'YTD'
                }, {
                        type: 'year',
                        count: 1,
                        text: '1y'
                }, {
                        type: 'all',
                        text: 'All'
                }],
                selected: 1
            };
            
        var plotoptions = {};

       	render();
	
	function createStyle()
	{
            var sel = document.getElementById("select_menu_1");
            filter = sel.options[sel.selectedIndex].value;

		if(g1rb1.checked)
		{
			limit = 1000;
			units = "msec";
			paramselect = "RTT";
                        titlename = "Round-Trip Time";
                        divid = "graph_div_1";
                        formatter = function(){
                            return ''+ '<p style="color:' + this.points[0].series.color +  ';">' + this.points[0].series.name+ '</p><br />' + Highcharts.dateFormat('%A, %e. %b %Y, %l:%M %p', this.x) +' <br/><b>'+ parseInt(this.points[0].y) +'</b> msec';
                        }
                        plotoptions = {};
		}
		else if(g1rb2.checked)
		{
			limit = 1000;
			units = "msec";
			paramselect = "LMRTT";
                        titlename = "Last Mile Latency";
                        divid = "graph_div_1";
                        formatter = function(){
                            return ''+ '<p style="color:' + this.points[0].series.color +  ';">' + this.points[0].series.name+ '</p><br />'+ Highcharts.dateFormat('%A, %e. %b %Y, %l:%M %p', this.x) +' <br/><b>'+ parseInt(this.points[0].y) +'</b> msec';
                        }
                        plotoptions = {};
		}
		else if(g1rb3.checked)
		{
			limit = 1000000;
			units = "KBps";
			paramselect = "AGGL3BITRATE";
                        titlename = "Download Throughput";
                        divid = "graph_div_1";
                        formatter = function(){
                            return ''+ '<p style="color:' + this.points[0].series.color +  ';">' + this.points[0].series.name+ '</p><br />'+ Highcharts.dateFormat('%A,%e. %b %Y, %l %p', this.x) +' <br/><b>'+ parseInt(this.points[0].y)+'</b> KBps';
                        }
                        plotoptions = {};
		}
                else if(g1rb4.checked)
                {
                        paramselect = "PASSIVE";
                        titlename = "Passive Data";
                        divid = "graph_div_1";
                        units = "MB"
                        formatter = function(){
                            return ''+ '<p style="color:' + this.points[0].series.color +  ';">' + this.points[0].series.name+ '</p><br />'+ Highcharts.dateFormat('%A,%e. %b %Y, %l %p', this.x) +' <br/><b>'+ parseInt(this.points[0].y/1000/1000) +'</b> MB';
                        }
                        plotoptions ={
                            series:{
                               dataGrouping:{
                                   groupPixelWidth: 50,
                                   units: [[
                                            'hour',
                                            [1]
                                    ], [
                                            'day',
                                            [1]
                                    ], [
                                            'week',
                                            [1]
                                    ], [
                                            'month',
                                            [1, 3, 6]
                                    ]]
                               } 
                            }
                        };
                }
                else if(g1rb5.checked)
                {
                        paramselect = "PASSIVE_PORT";
                        titlename = "Passive Data By Port";
                        divid = "graph_div_1";
                        units = "MB"
                        formatter = function(){
                            return ''+ '<p style="color:' + this.points[0].series.color +  ';">' + this.points[0].series.name+ '</p><br />'+ Highcharts.dateFormat('%A,%e. %b %Y, %l %p', this.x) +' <br/><b>'+ parseInt(this.points[0].y/1000/1000) +'</b> MB';
                        }
                        plotoptions ={
                            column: {
                              borderWidth: 0,
                              stacking: "normal"
                            },
                            series:{
                               dataGrouping:{
                                   groupPixelWidth: 50,
                                   units: [[
                                            'hour',
                                            [1]
                                    ], [
                                            'day',
                                            [1]
                                    ], [
                                            'week',
                                            [1]
                                    ], [
                                            'month',
                                            [1, 3, 6]
                                    ]]
                               } 
                            }                            
                        };
                }
                 
	}

     
        function feedback(link,windowname){
            if (! window.focus){
                return true;
            }
            var href;
            if (typeof(mylink) == 'string'){
               href=link;
            }
            else{
               href=link.href;
            }
            window.open(href, windowname, 'width=500,height=200,scrollbars=yes,location=0,status=0');
            return false;
        }
        
        function OnSuccess(data){
            if(data.length>200){
            window.chart = new Highcharts.StockChart({
            chart: {
                renderTo: divid,
                backgroundColor: "rgb(249,249,255)"
            },
            
            legend: legend,

            rangeSelector: rangeselector,

            title: {
                text: titlename
            },
            
            plotOptions: plotoptions,

            xAxis: {
                maxZoom: 1 * 24 * 3600000 // fourteen days
            },
            yAxis: {
                min: 0,
                maxZoom: 10000,
                title: {
                    text: units,
                    style:{
                        fontSize: 15
                    }
                }
              
            },
            
            tooltip: {
                                       formatter: formatter
            },
            
            series: eval(data)
        });
            }
            
            else{
                var div = document.getElementById(divid);
                div.innerHTML="<div id = 'error'><b>Insufficient Data</b></div>";
            }
        
        CloseProgressBar();
        }
        
        function OnSuccess2(data){
            if (data.length>200){
            window.chart = new Highcharts.StockChart({
            chart: {
                renderTo: "graph_div_2",
                backgroundColor: "rgb(249,249,255)"
            },
            
            legend: legend,

            rangeSelector: rangeselector,

            title: {
                text: "Upload Throughput"
            },
            
            plotOptions: plotoptions,

            xAxis: {
                maxZoom: 1 * 24 * 3600000 // fourteen days
            },
            
            tooltip: {
                                       formatter: formatter
            },
            series: eval(data)
        });
            }
        else{
            var div = document.getElementById('graph_div_2');
            div.innerHTML="<div id = 'error'><b>Insufficient Data</b></div>";
        }
            
        }
        
  
            
		

   
        
        function setDisplayMode(log){
            g.updateOptions({logscale:log});
            logdisplay = log;
        }
        
        function convertURL(name){
            return encodeURIComponent(name);
        }
        

	
        function OnError(data)
        {
	  alert("data loading failed");
        }
        
        function deleteDivs(){
            
            var dtag = document.getElementById('display_tag');
            while(dtag.hasChildNodes()){
                dtag.removeChild(dtag.lastChild);
            }  
        }
        
        function createGraphDivs(){
            var dtag = document.getElementById('display_tag');
            var outer = document.createElement('div');
            outer.setAttribute('id','graph_div_outer');
            outer.setAttribute('class','outergraphdiv');
            var gd1 = document.createElement('div');
            gd1.setAttribute('id','graph_div_1');
            gd1.setAttribute('class','graphdiv');
            outer.appendChild(gd1);
            dtag.appendChild(outer);
            if (paramselect == 'AGGL3BITRATE'){
                outer = document.createElement('div');
                outer.setAttribute('id','graph_div_outer2');
                outer.setAttribute('class','outergraphdiv');
                var gd2 = document.createElement('div');
                gd2.setAttribute('id','graph_div_2');
                gd2.setAttribute('class','graphdiv');

                outer.appendChild(gd2);
                dtag.appendChild(outer);
            }
            
        }
        
        function addRadios(){
            setDisplayMode(false);
            if(document.getElementById('lin')){
                return;
            }
            if(paramselect=='AGGL3BITRATE'){
                return;
            }
            var dtag = document.getElementById('graph_div_outer');
            var rdiv = document.createElement('div');
            rdiv.setAttribute('class','radiodiv');
            rdiv.setAttribute('id', 'radio_div');
            var r1 = "<input type='radio' name = 'mode' id='lin' onClick='setDisplayMode(false)' checked>";
            var r2 = "<input type='radio' name = 'mode' id='log' onClick='setDisplayMode(true)'>";
            rdiv.innerHTML = "Linear: ";
            rdiv.innerHTML += r1;
            rdiv.innerHTML += "Log: ";
            rdiv.innerHTML += r2;
            dtag.appendChild(rdiv);
        }
        
        
        function addLabels(){
            
            if(document.getElementById('label_1')){
                return;
            }
            var outer1 = document.getElementById('graph_div_outer');
            var label1 = document.createElement('div');
            
            if(paramselect == "AGGL3BITRATE"){
                var outer2 = document.getElementById('graph_div_outer2');
                label1.innerHTML = '<b>Download Throughput (kbps)</b> <br />';
                var label2 = document.createElement('div');
                label2.innerHTML = '<br/><br/><b>Upload Throughput (kbps)</b><br />';
                label2.setAttribute('id','label_2');
                label2.setAttribute('align','center');
                outer2.appendChild(label2);
            }
            else if(paramselect == "RTT"){
                label1.innerHTML = '<b> Round Trip Time (msec)</b><br />';
            }
            else if(paramselect == "LMRTT"){
                label1.innerHTML = '<b> Last-Mile Latency (msec)</b><br />';
            }
            
            label1.setAttribute('id','label_1');
            label1.setAttribute('align','center');
            outer1.appendChild(label1);
            
        }
           
	function render()
	{

        createStyle();
        deleteDivs();
        createGraphDivs();
	OpenProgressBar();
	if(paramselect=="PASSIVE_PORT"){
            $.ajax({
                        type: "GET",
                        url: "/line_passive_port/",
                        data: {'graphno' : 1, 'deviceid': "{{deviceid}}", 'filter_by': filter},
                        success: OnSuccess
                    });
        }
        else if (paramselect=="PASSIVE"){
            $.ajax({
                        type: "GET",
                        url: "/line_passive/",
                        data: {'graphno' : 1, 'deviceid': "{{deviceid}}", 'filter_by': filter},
                        success: OnSuccess
                    });
				
            
        }


       else if(paramselect=="AGGL3BITRATE"){
            $.ajax({
                    type: "GET",
                    url: "/line_bitrate/",
                    data: {'graphno' : 2, 'deviceid': "{{deviceid}}", 'filter_by': filter},
                    success: OnSuccess
                });

            $.ajax({
                    type: "GET",
                    url: "/line_bitrate/",
                    data: {'graphno' : 1, 'deviceid': "{{deviceid}}", 'filter_by': filter},
                    success: OnSuccess2
                });
        }
        else if(paramselect=="LMRTT") {
        $.ajax({
                type: "GET",
                url: "/line_lmrtt/",
                 data: {'deviceid': "{{deviceid}}", 'filter_by': filter},
                success: OnSuccess
            });
        }

        else{
        $.ajax({
                    type: "GET",
                    url: "/line_rtt/",
                    data: {'deviceid': "{{deviceid}}", 'filter_by': filter},
                    success: OnSuccess
                });
            }
    }

    function CloseProgressBar() {
                var progressbar_container = document.getElementById("progress");
                progressbar_container.style.display="none";
                //document.getElementById("graph_div").display = "block";

    }

    function OpenProgressBar() {
            var progressbar_container = document.getElementById("progress");
            progressbar_container.style.display="block";


    }

</script>
</body>


{% endblock %}
